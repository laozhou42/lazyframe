{"version":3,"file":"lazyframe.min.js","sources":["../src/lazyframe.js"],"sourcesContent":["const Lazyframe = () => {\n\n  let settings;\n\n  const elements = [];\n\n  const defaults = {\n    vendor: undefined,\n    id: undefined,\n    src: undefined,\n    thumbnail: undefined,\n    title: undefined,\n    apikey: undefined,\n    initialized: false,\n    parameters: undefined,\n    y: undefined,\n    debounce: 250,\n    lazyload: true,\n    autoplay: true,\n    initinview: false,\n    onLoad: (l) => {},\n    onAppend: (l) => {},\n    onThumbnailLoad: (img) => {}\n  };\n\n  const constants = {\n    regex: {\n      youtube_nocookie: /(?:youtube-nocookie\\.com\\/\\S*(?:(?:\\/e(?:mbed))?\\/|watch\\?(?:\\S*?&?v\\=)))([a-zA-Z0-9_-]{6,11})/,\n      youtube: /(?:youtube\\.com\\/\\S*(?:(?:\\/e(?:mbed))?\\/|watch\\?(?:\\S*?&?v\\=))|youtu\\.be\\/)([a-zA-Z0-9_-]{6,11})/,\n      vimeo: /vimeo\\.com\\/(?:video\\/)?([0-9]*)(?:\\?|)/,\n      vine: /vine.co\\/v\\/(.*)/\n    },\n    condition: {\n      youtube: (m) => (m && m[1].length == 11) ? m[1] : false,\n      youtube_nocookie: (m) => (m && m[1].length == 11) ? m[1] : false,\n      vimeo: (m) => (m && m[1].length === 9 || m[1].length === 8) ? m[1] : false,\n      vine: (m) => (m && m[1].length === 11) ? m[1] : false\n    },\n    src: {\n      youtube: (s) => `https://www.youtube.com/embed/${s.id}/?${s.parameters}`,\n      youtube_nocookie: (s) => `https://www.youtube-nocookie.com/embed/${s.id}/?${s.parameters}`,\n      vimeo: (s) => `https://player.vimeo.com/video/${s.id}/?${s.parameters}`,\n      vine: (s) => `https://vine.co/v/${s.id}/embed/simple`\n    },\n    endpoints: {\n      youtube: (s) => `https://www.googleapis.com/youtube/v3/videos?id=${s.id}&key=${s.apikey}&fields=items(snippet(title,thumbnails))&part=snippet`,\n      youtube_nocookie: (s) => `https://www.googleapis.com/youtube/v3/videos?id=${s.id}&key=${s.apikey}&fields=items(snippet(title,thumbnails))&part=snippet`,\n      vimeo: (s) => `https://vimeo.com/api/oembed.json?url=https%3A//vimeo.com/${s.id}`,\n      vine: (s) => `https://vine.co/oembed.json?url=https%3A%2F%2Fvine.co%2Fv%2F${s.id}`\n    },\n    response: {\n      youtube: {\n        title: (r) => r.items['0'].snippet.title,\n        thumbnail: (r) => {\n          let thumbs = r.items[\"0\"].snippet.thumbnails;\n          let thumb = thumbs.maxres || thumbs.standard || thumbs.high || thumbs.medium || thumbs.default;\n          return thumb.url;\n        }\n      },\n      youtube_nocookie: {\n        title: (r) => r.items['0'].snippet.title,\n        thumbnail: (r) => {\n          let thumbs = r.items[\"0\"].snippet.thumbnails;\n          let thumb = thumbs.maxres || thumbs.standard || thumbs.high || thumbs.medium || thumbs.default;\n          return thumb.url;\n        }\n      },\n      vimeo: {\n        title: (r) => r.title,\n        thumbnail: (r) => r.thumbnail_url\n      },\n      vine: {\n        title: (r) => r.title,\n        thumbnail: (r) => r.thumbnail_url\n      }\n    }\n  };\n\n  function init(elements, ...args) {\n    settings = Object.assign({}, defaults, args[0]);\n\n    if (typeof elements === 'string') {\n\n      const selector = document.querySelectorAll(elements);\n      for (let i = 0; i < selector.length; i++) {\n        loop(selector[i]);\n      }\n\n    } else if (typeof elements.length === 'undefined'){\n      loop(elements);\n\n    } else if (elements.length > 1) {\n\n      for (let i = 0; i < elements.length; i++) {\n        loop(elements[i]);\n      }\n\n    } else {\n      loop(elements[0]);\n    }\n\n    if (settings.lazyload) {\n      scroll();\n    }\n\n  }\n\n  function loop(el) {\n\n    if(el instanceof HTMLElement === false ||\n       el.classList.contains('lazyframe--loaded')) return;\n\n    const lazyframe = {\n      el: el,\n      settings: setup(el),\n    };\n\n    lazyframe.el.addEventListener('click', () => {\n      lazyframe.el.appendChild(lazyframe.iframe);\n\n      const iframe = el.querySelectorAll('iframe');\n      lazyframe.settings.onAppend.call(this, iframe[0]);\n    });\n\n    if (settings.lazyload) {\n      build(lazyframe);\n    } else {\n      api(lazyframe, !!lazyframe.settings.thumbnail);\n    }\n\n  }\n\n  function setup(el) {\n\n    const attr = Array.prototype.slice.apply(el.attributes)\n     .filter(att => att.value !== '')\n     .reduce((obj, curr) => {\n        let name = curr.name.indexOf('data-') === 0 ? curr.name.split('data-')[1] : curr.name;\n        obj[name] = curr.value;\n        return obj;\n     }, {});\n\n    const options = Object.assign({},\n      settings,\n      attr,\n      {\n        y: el.offsetTop,\n        parameters: extractParams(attr.src)\n      }\n    );\n\n    if (options.vendor) {\n      const match = options.src.match(constants.regex[options.vendor]);\n      options.id = constants.condition[options.vendor](match);\n    }\n\n    return options;\n\n  }\n\n  function extractParams(url) {\n    let params = url.split('?');\n\n    if (params[1]) {\n      params = params[1];\n      const hasAutoplay = params.indexOf('autoplay') !== -1;\n      return hasAutoplay ? params : params + '&autoplay=1';\n\n    } else {\n      return 'autoplay=1';\n    }\n\n  }\n\n  function useApi(settings) {\n\n    if (!settings.vendor) return false;\n\n    if (!settings.title || !settings.thumbnail) {\n      if (settings.vendor === 'youtube' || settings.vendor === 'youtube_nocookie') {\n        return !!settings.apikey;\n      } else {\n        return true;\n      }\n\n    } else {\n      return false;\n    }\n\n  }\n\n  function api(lazyframe) {\n\n    if (useApi(lazyframe.settings)) {\n      send(lazyframe, (err, data) => {\n        if (err) return;\n\n        const response = data[0];\n        const _l = data[1];\n\n        if (!_l.settings.title) {\n          _l.settings.title = constants.response[_l.settings.vendor].title(response);\n        }\n        if (!_l.settings.thumbnail) {\n          const url = constants.response[_l.settings.vendor].thumbnail(response);\n          _l.settings.thumbnail = url;\n          lazyframe.settings.onThumbnailLoad.call(this, url);\n        }\n        build(_l, true);\n\n      });\n\n    }else{\n      build(lazyframe, true);\n    }\n\n  }\n\n  function send(lazyframe, cb) {\n\n    const endpoint = constants.endpoints[lazyframe.settings.vendor](lazyframe.settings);\n    const request = new XMLHttpRequest();\n\n    request.open('GET', endpoint, true);\n\n    request.onload = function() {\n      if (request.status >= 200 && request.status < 400) {\n        const data = JSON.parse(request.responseText);\n        cb(null, [data, lazyframe]);\n      } else {\n        cb(true);\n      }\n    };\n\n    request.onerror = function() {\n      cb(true);\n    };\n\n    request.send();\n\n  }\n\n  function scroll() {\n\n    const height = window.innerHeight;\n    let count = elements.length;\n    const initElement = (el, i) => {\n      el.settings.initialized = true;\n      el.el.classList.add('lazyframe--loaded');\n      count--;\n      api(el);\n\n      if (el.settings.initinview) {\n        el.el.click();\n      }\n\n      el.settings.onLoad.call(this, el);\n    }\n\n    elements\n      .filter(el => el.settings.y < height)\n      .forEach(initElement);\n\n    const onScroll = debounce(() => {\n\n      up = lastY < window.pageYOffset;\n      lastY = window.pageYOffset;\n\n      if (up) {\n        elements\n          .filter(el => el.settings.y < (height + lastY) && el.settings.initialized === false)\n          .forEach(initElement);\n      }\n\n      if (count === 0) {\n        window.removeEventListener('scroll', onScroll, false);\n      }\n\n    }, settings.debounce);\n\n    let lastY = 0;\n    let t = false, up = false;\n    window.addEventListener('scroll', onScroll, false);\n\n    function debounce(func, wait, immediate) {\n      let timeout;\n      return function() {\n        let context = this, args = arguments;\n        let later = function() {\n          timeout = null;\n          if (!immediate) func.apply(context, args);\n        };\n        let callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) func.apply(context, args);\n      };\n    };\n\n  }\n\n  function build(lazyframe, loadImage) {\n\n    lazyframe.iframe = getIframe(lazyframe.settings);\n\n    if (lazyframe.settings.thumbnail && loadImage) {\n      lazyframe.el.style.backgroundImage = `url(${lazyframe.settings.thumbnail})`;\n    }\n\n    if (lazyframe.settings.title && lazyframe.el.children.length === 0) {\n      const docfrag = document.createDocumentFragment(),\n            titleNode = document.createElement('span');\n\n      titleNode.className = 'lazyframe__title';\n      titleNode.innerHTML = lazyframe.settings.title;\n      docfrag.appendChild(titleNode);\n\n      lazyframe.el.appendChild(docfrag);\n    }\n\n    if (!settings.lazyload) {\n      lazyframe.el.classList.add('lazyframe--loaded');\n      lazyframe.settings.onLoad.call(this, lazyframe);\n      elements.push(lazyframe);\n    }\n\n    if (!lazyframe.settings.initialized) {\n      elements.push(lazyframe);\n    }\n\n  }\n\n  function getIframe(settings) {\n\n    const docfrag = document.createDocumentFragment(),\n          iframeNode = document.createElement('iframe');\n\n    if (settings.vendor) {\n      settings.src = constants.src[settings.vendor](settings);\n    }\n\n    iframeNode.setAttribute('id', `lazyframe-${settings.id}`);\n    iframeNode.setAttribute('src', settings.src);\n    iframeNode.setAttribute('frameborder', 0);\n    iframeNode.setAttribute('allowfullscreen', '');\n    if (settings.autoplay) {\n      iframeNode.allow = 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture';\n    }\n\n    if (settings.vendor === 'vine') {\n      const scriptNode = document.createElement('script');\n      scriptNode.setAttribute('src', 'https://platform.vine.co/static/scripts/embed.js');\n      docfrag.appendChild(scriptNode);\n    }\n\n    docfrag.appendChild(iframeNode);\n    return docfrag;\n\n  }\n\n  return init;\n\n}\n\nconst lf = Lazyframe();\n\nexport default lf;\n"],"names":["settings","elements","defaults","vendor","undefined","id","src","thumbnail","title","apikey","initialized","parameters","y","debounce","lazyload","autoplay","initinview","onLoad","l","onAppend","onThumbnailLoad","img","constants","regex","youtube_nocookie","youtube","vimeo","vine","condition","m","length","s","endpoints","response","r","items","snippet","thumbs","thumbnails","maxres","standard","high","medium","url","thumbnail_url","loop","el","HTMLElement","classList","contains","lazyframe","setup","addEventListener","appendChild","iframe","querySelectorAll","call","_this","build","api","attr","Array","prototype","slice","apply","attributes","filter","att","value","reduce","obj","curr","name","indexOf","split","options","_extends","offsetTop","extractParams","match","params","useApi","cb","endpoint","request","XMLHttpRequest","open","onload","status","data","JSON","parse","responseText","onerror","send","err","_l","_this2","scroll","height","window","innerHeight","count","initElement","i","add","click","_this3","forEach","func","wait","immediate","timeout","onScroll","up","lastY","pageYOffset","removeEventListener","context","this","args","arguments","later","callNow","clearTimeout","setTimeout","loadImage","docfrag","document","createDocumentFragment","iframeNode","createElement","setAttribute","allow","scriptNode","getIframe","style","backgroundImage","children","titleNode","className","innerHTML","push","selector","Lazyframe"],"mappings":"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"}